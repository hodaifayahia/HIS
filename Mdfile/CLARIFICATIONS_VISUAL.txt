â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘              ğŸ¥ ADMISSION SYSTEM v2 - CLARIFICATIONS VISUAL ğŸ¥              â•‘
â•‘                                                                              â•‘
â•‘                        Updated November 13, 2025                             â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“Š MODEL CHANGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  v1 (9 MODELS)                          v2 (7 MODELS)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âœ— Admission                            âœ“ Admission (unified, with type field)
  âœ— AdmissionSurgery        â”€â”€â”€â”€â†’        â”‚ type = 'surgery' | 'nursing'
  âœ— AdmissionNursingCare    â”€â”€â”€â”€â†’        â”‚
  âœ“ AdmissionProcedure                   âœ“ AdmissionProcedure (same)
  âœ— AdmissionMedication     â”€â”€â”€â”€â†’        âœ— REMOVED (use PharmacyProduct)
  âœ“ AdmissionMedicationConsumption       âœ“ AdmissionMedicationConsumption
  âœ“ AdmissionDocument                    âœ“ AdmissionDocument
  âœ“ AdmissionBillingRecord               âœ“ AdmissionBillingRecord
  âœ“ AdmissionDischargeTicket             âœ“ AdmissionDischargeTicket
                                         âœ“ AdmissionDocumentComparison


ğŸ¯ CORE LOGIC CLARIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ SURGERY TYPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Admission.type = 'surgery'                                                 â”‚
â”‚                                                                             â”‚
â”‚  âœ… Requires upfront payment (UNIQUE)                                       â”‚
â”‚  âœ… Initial prestation mandatory                                            â”‚
â”‚  âœ… Can't proceed without payment                                           â”‚
â”‚  âœ… Medications consumed during surgery                                     â”‚
â”‚  âœ… If medications > 5000 DA â†’ Auto-convert to procedure                   â”‚
â”‚  âœ… Then patient pays remaining balance                                     â”‚
â”‚                                                                             â”‚
â”‚  FLOW: Define surgery â†’ Pay upfront â†’ Perform â†’ Track meds â†’ Discharge    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ NURSING TYPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Admission.type = 'nursing'                                                 â”‚
â”‚                                                                             â”‚
â”‚  âŒ NO upfront payment required (UNIQUE)                                    â”‚
â”‚  âœ… Procedures added as needed                                              â”‚
â”‚  âœ… Patient pays after services complete                                    â”‚
â”‚  âœ… Medications tracked as consumed                                         â”‚
â”‚  âœ… If medications > 5000 DA â†’ Auto-convert to procedure                   â”‚
â”‚  âœ… Calculate final total bill                                              â”‚
â”‚                                                                             â”‚
â”‚  FLOW: Start care â†’ Track services â†’ Calculate bill â†’ Patient pays        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ’Š MEDICATION CONSUMPTION RULE (THE KEY RULE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SCENARIO: Patient receives medications during stay

  Medication #1    1,000 DA  â”‚
  Medication #2    2,000 DA  â”œâ”€â†’ TOTAL: 5,500 DA (> 5000 DA threshold)
  Medication #3    2,500 DA  â”‚

TRIGGER:
  IF total_medications > 5000 DA:

    1. Create AdmissionProcedure
       â”œâ”€ is_medication_conversion = true
       â”œâ”€ conversion_note = "Generated from medication total: 5,500 DA"
       â””â”€ This becomes a billable item

    2. Mark all medications
       â””â”€ converted_to_procedure_id = (new procedure id)

    3. Create AdmissionBillingRecord
       â”œâ”€ item_type = 'procedure'
       â”œâ”€ amount = 5,500 DA
       â””â”€ is_post_admission = true

RESULT:
  âœ… Medications no longer bill individually
  âœ… Final bill shows: "Medication Services: 5,500 DA"
  âœ… Cleaner billing, easier to understand
  âœ… Patient pays for "medication services" not 50 separate items


ğŸ“„ ficheNavette ACCESS (NOT DUPLICATED)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BEFORE:
  â””â”€ Patient has consultation (ficheNavette)
  â””â”€ Patient gets admitted (Admission)
  â””â”€ These were separate and unconnected

AFTER:
  â””â”€ Patient has consultation (ficheNavette) â† INDEPENDENT
     â”‚
     â””â”€ When viewing admission:
        â””â”€ Can see today's ficheNavette (read-only, for context)

KEY POINTS:
  âœ“ ficheNavette stays independent
  âœ“ Admission stays independent
  âœ“ But admission can VIEW today's ficheNavette
  âœ“ No data duplication
  âœ“ No merging
  âœ“ Just accessible for reference

EXAMPLE:
  Patient comes in, has consultation with doctor (ficheNavette created)
  Later, needs emergency surgery (Admission created)
  During surgery admission process, can see:
    "Patient consulted about chest pain at 09:00"
    "Imaging showed pneumothorax"
    "Now admitted for surgical intervention"


ğŸ’° PRICING - WHERE IS IT?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OLD PROBLEM (v1):
  Admission model had price fields
  ficheNavette had different pricing
  Confusion: Which price to use?

NEW SOLUTION (v2):
  ALL pricing comes from ficheNavette relationships

  AdmissionProcedure
    â””â”€ prestation_id â†’ links to Prestation
                      â””â”€ Has public_price, vat_rate, etc.

  AdmissionMedicationConsumption
    â””â”€ Uses unit_cost from PharmacyProduct
                      â””â”€ Has pricing, cost tracking, etc.

  AdmissionBillingRecord
    â””â”€ amount field (calculated from above)

BENEFIT:
  âœ“ Single source of truth (ficheNavette)
  âœ“ Easier to update pricing
  âœ“ Consistent with HIS architecture
  âœ“ No duplicate pricing logic


ğŸ”„ SIDE-BY-SIDE SURGERY WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: Create Admission
  Input: patient_id, doctor_id, type='surgery'
  Output: Admission created, status='admitted'

STEP 2: Upload Documents
  Input: Upload physical paperwork (consent, history, etc)
  Output: AdmissionDocuments created, is_physical_uploaded=true

STEP 3: Define Surgery
  Input: Select prestation, schedule time
  Output: AdmissionProcedure created, status='scheduled'

STEP 4: UPFRONT PAYMENT â† UNIQUE TO SURGERY
  Input: Payment amount (from prestation price)
  Output: AdmissionBillingRecord created (is_post_admission=false)
          Payment recorded in Caisse
          remaining_balance updated

STEP 5: Perform Surgery & Track Medications
  Input: Add medications as used (morphine, antibiotics, etc)
  Output: AdmissionMedicationConsumption records created
          Running total tracked

STEP 6: Check Medication Total
  IF medications_total > 5000 DA:
    â†’ Create AdmissionProcedure (is_medication_conversion=true)
    â†’ Mark medications as converted
    â†’ Create AdmissionBillingRecord for procedure

STEP 7: Verify Documents
  Input: Compare physical docs to digital records
  Output: AdmissionDocumentComparison records
          If mismatch: Can cancel procedures

STEP 8: Final Payment
  Input: Bill remaining balance
  Output: AdmissionBillingRecord for remaining items
          Accept payment
          remaining_balance = 0

STEP 9: Discharge
  Input: Authorize discharge (doctor clicks "OK")
  Output: AdmissionDischargeTicket generated
          Exit PDF created
          Admission status = 'ready_for_discharge'
          ONLY POSSIBLE IF remaining_balance = 0


ğŸ”„ SIDE-BY-SIDE NURSING WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: Create Admission
  Input: patient_id, doctor_id, type='nursing'
  Output: Admission created, status='admitted'

STEP 2: Upload Documents
  Input: Upload physical paperwork
  Output: AdmissionDocuments created

STEP 3: NO PAYMENT YET â† UNIQUE TO NURSING
  Output: No upfront billing record created

STEP 4: Provide Nursing Care
  Input: Add procedures, medications
  Output: AdmissionProcedure, AdmissionMedicationConsumption records

STEP 5: Track Medications
  Input: Medications added as consumed
  Output: Running total tracked
  IF total > 5000 DA:
    â†’ Create AdmissionProcedure (is_medication_conversion=true)

STEP 6: Verify Documents
  Input: Compare physical docs to digital records
  Output: AdmissionDocumentComparison records

STEP 7: Calculate Final Bill
  Input: All procedures, medications, services
  Output: Total bill amount calculated
          Remaining_balance = total_bill

STEP 8: Patient Payment
  Input: Accept payment
  Output: AdmissionBillingRecord for payment
          remaining_balance updated

STEP 9: Discharge (only if remaining_balance = 0)
  Input: Authorize discharge
  Output: AdmissionDischargeTicket generated
          Discharge impossible if balance > 0


âœ… IMPLEMENTATION READINESS CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Business Logic Clarity:
  âœ… Surgery = upfront payment required
  âœ… Nursing = no upfront payment
  âœ… Medication > 5000 DA = auto-convert to procedure
  âœ… ficheNavette = accessible but independent
  âœ… Pricing = all from ficheNavette

Model Simplification:
  âœ… 7 models instead of 9
  âœ… Medications model removed
  âœ… Surgery/Nursing unified into type field
  âœ… Clear relationships documented

Code Reduction:
  âœ… ~40% less code
  âœ… Simpler services
  âœ… Fewer edge cases
  âœ… Better aligned with HIS patterns

Documentation:
  âœ… 2 new v2 documents created
  âœ… All workflows detailed
  âœ… Business rules explicit
  âœ… Integration points documented

Phase 1 Ready:
  âœ… Database schema complete
  âœ… Model relationships clear
  âœ… 7 migrations ready to create
  âœ… Integration with existing models documented


ğŸ“ˆ TIMELINE IMPACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ORIGINAL ESTIMATE:    25-35 hours
AFTER SIMPLIFICATION: 20-28 hours (20% reduction)

Phase Breakdown:
  Phase 1 (Migrations)  1-2 hours   â–ˆâ–ˆâ–ˆâ–ˆ
  Phase 2 (Models)      2-3 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Phase 3 (Services)    2-3 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Phase 4 (Controllers) 2-3 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Phase 5 (Tests)       2-3 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Phase 6 (Vue)         3-4 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  Phases 7+ (Polish)    3-4 hours   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Total Time Saved:      3-5 hours


âœ¨ KEY TAKEAWAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Surgery vs Nursing = Just a TYPE field
   â””â”€ Single Admission model with type='surgery' | 'nursing'

2. Upfront Payment = Only for Surgery Type
   â””â”€ Enforced at service layer

3. Medication >5000 DA = Auto-Convert to Procedure
   â””â”€ Simplifies billing, cleaner final bill

4. ficheNavette = Accessible but Independent
   â””â”€ Patient can view consultations during admission

5. All Pricing = From ficheNavette
   â””â”€ Single source of truth

6. 7 Models = Complete System
   â””â”€ No redundancy, all necessary

7. Implementation = 20-28 Hours
   â””â”€ Phase 1 starts with migrations


ğŸš€ READY TO START?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

YES, IF YOU:
  âœ… Understand surgery = upfront payment
  âœ… Understand nursing = pay after
  âœ… Understand medication >5000 DA rule
  âœ… Understand ficheNavette is read-only reference
  âœ… Understand pricing comes from ficheNavette
  âœ… Approved 7-model design
  âœ… Ready to commit 20-28 hours

NEXT STEPS:
  1. Read ADMISSION_SYSTEM_v2.md (detailed reference)
  2. Read ADMISSION_QUICK_REFERENCE_v2.md (quick overview)
  3. Confirm all clarifications
  4. Begin Phase 1: Create 7 migrations
  5. Follow ADMISSION_START_GUIDE.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            READY FOR IMPLEMENTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
